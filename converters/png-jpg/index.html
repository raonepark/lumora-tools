 <!-- PNG ↔ JPG 변환기 (namespaced, responsive, full features kept) -->
 <div id="imgx">
   <style>
    #imgx{ --panel:#1f2024; --panel-alt:#25262b; --panel-soft:#1a1b1f; --text:#eceff4; --muted:#a5acb8; --accent:#7aa2ff; --accent-strong:#4f7cff; --accent-soft:rgba(122,162,255,.16); --border:#30323a; --guide-font-family:'Noto Sans',system-ui,sans-serif; --guide-font-size:clamp(12.5px, 0.88rem, 14.5px); --guide-title-size:clamp(14px, 0.95rem, 16px); --guide-color:#dfe6ff; --guide-strong-color:#ffffff; color:var(--text); }
     #imgx *{ box-sizing:border-box; }
    #imgx .wrap{max-width:760px;margin:28px auto;padding:0 16px}
    #imgx .card{background:linear-gradient(145deg,#202229 0%,#18191d 100%);border:1px solid rgba(255,255,255,.05);border-radius:20px;box-shadow:0 22px 45px rgba(0,0,0,.45)}
    #imgx .card h1{font-size:21px;margin:0;padding:20px 24px;border-bottom:1px solid rgba(255,255,255,.05);color:#f6f8ff;display:flex;align-items:center;gap:12px;letter-spacing:-.01em}
    #imgx .card h1::after{content:'IMAGE TOOL';font-size:12px;font-weight:500;color:var(--muted);margin-left:auto;letter-spacing:.22em}
    #imgx .content{padding:22px 24px}
    #imgx .grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
    #imgx .section-gap{margin-top:18px}
    #imgx .panel{border:1px solid rgba(255,255,255,.05);border-radius:16px;padding:16px;background:var(--panel-soft);box-shadow:0 12px 30px rgba(0,0,0,.32)}
    #imgx .panel .kv strong{color:#f2f4ff;font-weight:700;letter-spacing:-.01em}
    #imgx .drop{border:1.5px dashed rgba(122,162,255,.38);border-radius:18px;padding:24px;text-align:center;background:linear-gradient(135deg,rgba(122,162,255,.08),rgba(122,162,255,0));transition:border-color .2s ease,box-shadow .2s ease,transform .2s ease}
    #imgx .drop.hover{border-color:var(--accent);box-shadow:0 0 0 4px rgba(122,162,255,.2);transform:translateY(-2px)}
    #imgx .drop strong{display:block;font-size:16px;font-weight:700;color:#f5f7ff;margin-bottom:6px}
    #imgx .drop p{margin:0;color:var(--muted);font-size:13px;line-height:1.6}
    #imgx .meta-bar{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px;align-items:center;justify-content:center}
    #imgx .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:7px 12px;color:var(--muted);background:rgba(255,255,255,.04);font-size:12px;font-weight:500}
    #imgx .chip.info{color:var(--text);background:rgba(255,255,255,.06)}
    #imgx .chip.tag{color:#adc5ff;background:var(--accent-soft);border-color:rgba(122,162,255,.4);font-weight:600}
    #imgx .chip.badge{background:rgba(255,255,255,.04);color:var(--muted);font-weight:600}
    #imgx .chip.badge.highlight{color:#adc5ff;background:var(--accent-soft);border-color:rgba(122,162,255,.4)}
    #imgx label.chip{cursor:pointer}
    #imgx .btns{display:flex;gap:10px;flex-wrap:wrap}
    #imgx .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;background:#2b2d34;border:1px solid rgba(255,255,255,.06);color:#f1f3f7;padding:10px 16px;border-radius:12px;cursor:pointer;text-decoration:none;transition:background-color .2s ease,box-shadow .2s ease,transform .2s ease}
    #imgx .btn:hover:not([disabled]){background:#353842;transform:translateY(-1px);box-shadow:0 10px 26px rgba(0,0,0,.32)}
    #imgx .btn:active:not([disabled]){transform:translateY(0);box-shadow:0 4px 12px rgba(0,0,0,.35)}
    #imgx .btn.primary{background:linear-gradient(135deg,#7aa2ff,#4f7cff);border-color:rgba(122,162,255,.35);color:#07132f;font-weight:700}
    #imgx .btn.primary:hover:not([disabled]){background:linear-gradient(135deg,#8bb1ff,#5f8aff);box-shadow:0 12px 28px rgba(122,162,255,.32)}
    #imgx .btn.danger{background:linear-gradient(135deg,#3f2528,#2a1719);border-color:rgba(255,120,120,.32)}
    #imgx .btn.danger:hover:not([disabled]){background:linear-gradient(135deg,#532f33,#352021)}
    #imgx .btn.download{background:linear-gradient(135deg,#5fd3ff,#4f9aff);border-color:rgba(95,211,255,.4);color:#061d2b;font-weight:700;box-shadow:0 12px 28px rgba(95,211,255,.3)}
    #imgx .btn.download:hover:not([disabled]){background:linear-gradient(135deg,#74dbff,#65aaff)}
    #imgx .btn.download[aria-disabled="true"],#imgx .btn[disabled]{opacity:.55;cursor:not-allowed;box-shadow:none;transform:none;pointer-events:none}
    #imgx .btn-auto{padding:8px 14px;font-size:13px;font-weight:600;min-width:0}
    #imgx .range{width:100%}
    #imgx .mono{font-family:ui-monospace,Consolas,monospace;font-size:12px;color:#cfd3da}
    #imgx .hint{color:var(--muted);font-size:12px}
    #imgx .kv{display:flex;align-items:center;justify-content:space-between;gap:12px}
    #imgx .thumb{border:1px solid rgba(255,255,255,.06);background:linear-gradient(160deg,#14151a,#1a1c22);border-radius:14px;display:flex;align-items:center;justify-content:center;min-height:220px;overflow:hidden}
    #imgx .thumb img{max-width:100%;max-height:360px;display:block}
    #imgx .footer{padding:20px 24px;border-top:1px solid rgba(255,255,255,.05);display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap;background:rgba(0,0,0,.18);border-radius:0 0 20px 20px}
    #imgx .status{flex:1 1 260px;white-space:pre-line;line-height:1.5;word-break:keep-all;min-width:200px;max-width:100%;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:12px;padding:12px 14px;font-size:13px;color:#cdd3e3}
    #imgx .footer .btns{justify-content:flex-end;flex:1 1 auto}
    #imgx .footer .btns .btn{min-width:112px}
    #imgx .guide{background:linear-gradient(160deg,#1b1c20,#16171a);border:1px solid rgba(255,255,255,.05);border-radius:18px;padding:20px 22px;margin:22px auto 32px;max-width:760px}
    #imgx .guide h2{margin:0 0 12px;font-size:var(--guide-title-size);font-weight:700;color:var(--guide-strong-color);letter-spacing:-.01em}
    #imgx .guide-steps{display:flex;flex-direction:column;gap:14px;margin:0;padding:0 6px;}
    #imgx .guide-step{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:16px 20px;font-size:var(--guide-font-size);line-height:1.75;color:var(--guide-color);text-align:left;box-shadow:0 8px 20px rgba(0,0,0,.25)}
    
    #imgx .guide-step b{color:#fff;font-weight:600}
    @media (min-width:721px){
      #imgx .guide-steps{gap:18px;padding:0 10px;}
      #imgx .guide-step{padding:18px 26px;border-radius:16px;}
    }
     @media (max-width:720px){
      #imgx{--guide-font-size:13px;--guide-title-size:15px}
      #imgx .wrap{padding:0 14px}
      #imgx .card h1{padding:18px 20px;font-size:19px}
      #imgx .content{padding:20px}
      #imgx .grid2{grid-template-columns:1fr}
      #imgx .footer{padding:18px}
      #imgx .footer .btns{justify-content:flex-start}
      #imgx .status{flex:1 1 100%;min-width:0}
    }
  </style>

   <div class="wrap">
     <div class="card">
       <h1>PNG ↔ JPG 변환기</h1>
       <div class="content">
         <!-- 업로드 -->
         <div class="panel drop" id="x-drop" tabindex="0" role="button" aria-label="이미지 업로드 영역">           <strong>파일을 여기에 드래그하거나 클릭해서 선택</strong>
           <p>지원: PNG, JPG · 최대 25MB (브라우저 메모리 한도 내)</p>
           <div class="meta-bar">
             <label class="chip info" for="x-file" id="x-label">파일 선택</label>
             <input id="x-file" type="file" accept="image/png,image/jpeg" style="display:none"/>
             <span class="chip info" id="x-meta">원본: 없음</span>
             <span class="chip tag" id="x-fmtTag">출력: 자동</span>
           </div>
         </div>

         <!-- 포맷 & 옵션 -->
         <div class="grid2 section-gap">
           <div class="panel">
             <div class="kv"><strong>출력 포맷</strong><span class="chip badge highlight">자동 추천</span></div>
             <div class="btns" style="margin-top:8px">
               <button id="x-toJpg" class="btn">PNG → JPG</button>
               <button id="x-toPng" class="btn">JPG → PNG</button>
               <button id="x-auto"  class="btn primary btn-auto">자동 (입력 반대)</button>
             </div>
           </div>
           <div class="panel">
             <div class="kv"><strong>옵션</strong><span class="chip badge">JPG 품질 · 배경색</span></div>
             <div style="margin-top:6px;display:flex;flex-direction:column;gap:10px">
               <div class="kv">
                 <span>JPG 품질 <span id="x-qv" class="mono">0.92</span></span>
                 <input id="x-quality" class="range" type="range" min="0.1" max="1" value="0.92" step="0.01" />
               </div>
               <div class="kv">
                 <span>배경색 (PNG→JPG 시 투명 영역 채움)</span>
                 <input id="x-bg" type="color" value="#ffffff" style="width:120px;height:36px;border-radius:8px;border:1px solid var(--border);background:none;cursor:pointer"/>
               </div>
             </div>
           </div>
         </div>

         <!-- 미리보기 -->
         <div class="grid2 section-gap">
           <div class="panel">
             <div class="kv" style="margin-bottom:8px"><strong>원본 미리보기</strong><span id="x-origInfo" class="hint">-</span></div>
             <div class="thumb" id="x-origThumb"><span class="hint">이미지를 업로드하세요</span></div>
           </div>
           <div class="panel">
             <div class="kv" style="margin-bottom:8px"><strong>변환 결과</strong><span id="x-outInfo" class="hint">-</span></div>
             <div class="thumb" id="x-outThumb"><span class="hint">아직 변환 전입니다</span></div>
           </div>
         </div>
       </div>

       <div class="footer">
         <div id="x-status" class="hint status">대기 중</div>
         <div class="btns">
           <button id="x-clear" class="btn danger" disabled>지우기</button>
           <button id="x-convert" class="btn primary" disabled>변환하기</button>
           <a id="x-download" class="btn download" download style="display:none" aria-disabled="true">다운로드</a>
         </div>
       </div>
     </div>

     <div class="guide">
       <h2>사용 방법</h2>
       <div class="guide-steps">
         <div class="guide-step"><b>이미지 업로드:</b> PNG 또는 JPG를 업로드합니다. (권장: 최대 25MB)</div>
         <div class="guide-step"><b>출력 포맷:</b> 자동(입력 반대) 또는 직접 PNG↔JPG를 선택합니다.</div>
         <div class="guide-step"><b>옵션:</b> JPG로 저장 시 품질과 배경색(투명 채움)을 조정합니다.</div>
         <div class="guide-step"><b>변환하기:</b> 변환 후 <b>다운로드</b>로 저장합니다.</div>
       </div>
     </div>
   </div>

   <canvas id="x-canvas" style="display:none"></canvas>

   
    <script>
    ;(function(){
      const qs = (sel)=>document.querySelector('#imgx ' + sel);
      const drop = qs('#x-drop'), input = qs('#x-file'), label = qs('#x-label');
      const meta = qs('#x-meta'), fmtTag = qs('#x-fmtTag');
      const origThumb = qs('#x-origThumb'), outThumb = qs('#x-outThumb');
      const origInfo = qs('#x-origInfo'), outInfo = qs('#x-outInfo');
      const btnConvert = qs('#x-convert'), btnClear = qs('#x-clear'), aDownload = qs('#x-download');
      const toJpg = qs('#x-toJpg'), toPng = qs('#x-toPng'), autoBtn = qs('#x-auto');
      const quality = qs('#x-quality'), qv = qs('#x-qv'), bg = qs('#x-bg');
      const statusEl = qs('#x-status');
      const canvas = qs('#x-canvas');
      const ctx = canvas ? canvas.getContext('2d') : null;

      let file = null, img = null, target = 'auto';

      const fmtBytes = (b)=>{ if(!Number.isFinite(b)) return '-'; const u=['B','KB','MB','GB']; let i=0,v=b; while(v>1024&&i<u.length-1){v/=1024;i++} return v.toFixed(i?2:0)+' '+u[i]; };
      const setStatus = (t)=> statusEl.textContent = t;
      const hexToRgb = (h)=>{ const m=/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i.exec(h); return m?{r:parseInt(m[1],16),g:parseInt(m[2],16),b:parseInt(m[3],16)}:{r:255,g:255,b:255}; };
      function isSupportedImage(f){
        const t=(f.type||'').toLowerCase();
        if (t==='image/png'||t==='image/jpeg'||t==='image/jpg'||t==='image/pjpeg'||t==='image/x-png') return true;
        const ext=(f.name.split('.').pop()||'').toLowerCase();
        return ext==='png'||ext==='jpg'||ext==='jpeg';
      }
      function chooseTargetAuto(){
        if(!file) return 'jpg';
        const ext=(file.name.split('.').pop()||'').toLowerCase();
        return ext==='png' ? 'jpg' : 'png';
      }
      function updateFmtTag(){
        const t=(target==='auto'? chooseTargetAuto(): target).toUpperCase();
        fmtTag.textContent='출력: '+t;
      }
      function resetOutput(){
        outThumb.innerHTML='<span class="hint">아직 변환 전입니다</span>';
        outInfo.textContent='-';
        aDownload.style.display='none'; aDownload.removeAttribute('href'); aDownload.removeAttribute('download'); aDownload.setAttribute('aria-disabled','true');
      }

      // ✅ 단일 loadFile (ObjectURL 사용)
      function loadFile(f){
        if(!f) return;
        if(!isSupportedImage(f)){ alert('PNG 또는 JPG만 지원합니다.'); return; }
        file=f; resetOutput(); updateFmtTag();
        meta.textContent='원본: '+file.name+' · '+fmtBytes(file.size);
        const url = URL.createObjectURL(f);
        const im = new Image();
        im.onload = ()=>{
          img = im;
          origThumb.innerHTML = '';
          im.alt = '원본 미리보기';
          origThumb.appendChild(im);        // 새 태그 만들지 말고, 로드된 노드 그대로 붙임
          origInfo.textContent = im.naturalWidth + '×' + im.naturalHeight;
          btnConvert.disabled = false; btnClear.disabled = false;
          setStatus('이미지 로드 완료'); input.value = ''; updateFmtTag();
          // 미리보기가 그려진 다음 URL 해제 (너무 일찍 revoke하면 깨짐)
          setTimeout(()=> URL.revokeObjectURL(url), 1000);
        };
        im.onerror = ()=>{
          URL.revokeObjectURL(url);
          alert('이미지를 불러오지 못했습니다.');
          btnConvert.disabled = true;
        };
        im.src = url;
      }

      // DnD & 클릭 (옵셔널 체이닝 제거)
      ['dragenter','dragover'].forEach(function(type){
        drop.addEventListener(type, function(e){ e.preventDefault(); drop.classList.add('hover'); });
      });
      ['dragleave','drop'].forEach(function(type){
        drop.addEventListener(type, function(e){ e.preventDefault(); drop.classList.remove('hover'); });
      });
      drop.addEventListener('drop', function(e){
        var files = e.dataTransfer && e.dataTransfer.files;
        var f = files && files[0];
        if(f) loadFile(f);
      });
      label.addEventListener('click', function(e){ e.stopPropagation(); });
      drop.addEventListener('click', function(){ input.click(); });
      input.addEventListener('change', function(e){
        var files = e.target && e.target.files;
        var f = files && files[0];
        if(f) loadFile(f);
      });

      // 포맷 선택
      toJpg.onclick=function(){ target='jpg'; updateFmtTag(); };
      toPng.onclick=function(){ target='png'; updateFmtTag(); };
      autoBtn.onclick=function(){ target='auto'; updateFmtTag(); };

      // 옵션 표시
      quality.oninput=function(){ qv.textContent = Number(quality.value).toFixed(2); };

      function renderToCanvas(targetMime){
        if(!ctx||!img) return;
        const w=img.naturalWidth, h=img.naturalHeight;
        canvas.width=w; canvas.height=h;
        if(targetMime==='image/jpeg'){
          const {r,g,b}=hexToRgb(bg.value);
          ctx.save(); ctx.fillStyle=`rgb(${r},${g},${b})`; ctx.fillRect(0,0,w,h); ctx.restore();
        }else{
          ctx.clearRect(0,0,w,h);
        }
        ctx.drawImage(img,0,0,w,h);
      }
      function convert(){
        if(!img) return;
        btnConvert.disabled=true; setStatus('변환 중…');
        const autoExt=chooseTargetAuto();
        const targetMime=(target==='auto' ? (autoExt==='jpg'?'image/jpeg':'image/png') : (target==='jpg'?'image/jpeg':'image/png'));
        renderToCanvas(targetMime);
        const q=Number(quality.value);
        const dataUrl=canvas.toDataURL(targetMime, targetMime==='image/jpeg' && isFinite(q)? q : undefined);
        outThumb.innerHTML=''; const outImg=new Image(); outImg.src=dataUrl; outImg.alt='변환 미리보기'; outThumb.appendChild(outImg);
        const base64=dataUrl.split(',')[1]||''; const bytes=Math.ceil(base64.length*3/4);
        outInfo.textContent=(targetMime==='image/jpeg'?'JPG':'PNG')+' · '+fmtBytes(bytes);
        const base=(file && file.name ? file.name : 'image').replace(/\.(png|jpg|jpeg)$/i,'');
        const outName=base+(targetMime==='image/jpeg'?'.jpg':'.png');
        aDownload.href=dataUrl; aDownload.download=outName; aDownload.style.display='inline-flex'; aDownload.removeAttribute('aria-disabled');
        setStatus('완료'); btnConvert.disabled=false;
      }
      btnConvert.addEventListener('click', convert);

      function clearAll(){
        file=null; img=null; target='auto';
        meta.textContent='원본: 없음';
        origThumb.innerHTML='<span class="hint">이미지를 업로드하세요</span>'; origInfo.textContent='-';
        resetOutput(); btnConvert.disabled=true; btnClear.disabled=true; setStatus('초기화 완료'); input.value=''; updateFmtTag();
      }
      btnClear.addEventListener('click', clearAll);

      setStatus('이미지를 업로드한 뒤 포맷을 선택하고 변환하세요.\nPNG→JPG 시 투명 영역은 선택한 배경색으로 채워집니다.');
    })();
  </script>
</div>



























