<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF → 이미지 변환기 · Lumora</title>
  <style>
    :root{ --bg:#1e1e1e; --panel:#262626; --text:#e8eaed; --muted:#9aa0a6; --accent:#7aa2ff; --border:#3a3a3a; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif}
    .wrap{max-width:980px;margin:40px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .card h1{font-size:22px;margin:0;padding:20px;border-bottom:1px solid var(--border)}
    .body{padding:18px}
    .row{display:flex;gap:18px;flex-wrap:wrap}
    .col{flex:1;min-width:280px}
    .drop{padding:18px;border:2px dashed #4a4a4a;border-radius:12px;text-align:center;color:var(--muted);background:#202020}
    .drop.drag{border-color:var(--accent);background:#1b2233;color:#cfe0ff}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#333;color:#fff;cursor:pointer}
    .btn.primary{background:var(--accent);color:#081126;border-color:#5d83ff;font-weight:700}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .opts label{display:block;margin:8px 0 4px;color:#c9d1d9}
    .opts input,.opts select{width:100%;padding:8px 10px;background:#1f1f1f;border:1px solid #3a3a3a;border-radius:8px;color:#e6edf3}
    .progress{height:8px;background:#1a1a1a;border:1px solid #333;border-radius:999px;overflow:hidden}
    .progress>div{height:100%;width:0;background:linear-gradient(90deg,#7aa2ff,#9cd6ff)}
    .small{font-size:12px;color:var(--muted)}
    .hint{color:#b6bec8;font-size:12px;margin-top:8px}

    /* Single Page Viewer */
    .viewer{border:2px dashed #4a4a4a;border-radius:12px;background:#202020;padding:10px}
    .vbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    .vbar .seg{display:flex;gap:6px;align-items:center}
    .vbtn{background:#2a2a2a;border:1px solid #3a3a3a;color:#e6edf3;border-radius:8px;padding:6px 10px;cursor:pointer}
    .stage{position:relative;height:520px;overflow:auto;border:1px solid #333;border-radius:10px;background:#111;display:flex;align-items:flex-start;justify-content:center}
    .stage canvas{display:block}

    footer{margin-top:28px;font-size:12px;color:#9aa0a6;text-align:center;line-height:1.6}
    .usage{margin-top:30px;padding:16px;border-radius:12px;background:#1f1f1f;border:1px solid #2f2f2f;color:#d0d6dc;font-size:13px !important;line-height:1.6 !important}
    .usage h2{font-size:15px !important;line-height:1.4 !important;margin-top:0 !important;margin-bottom:8px !important;color:#ffffff !important;font-weight:700 !important}
    .usage ul{margin:6px 0 0 18px !important;padding:0 !important;list-style:disc !important;font-size:13px !important}
    .usage li{margin:4px 0 !important}
    .usage strong{font-weight:600 !important}
    .usage em{font-style:italic !important}
  </style>
  <noscript><div style="background:#4b0000;color:#fff;padding:12px">이 도구는 자바스크립트가 필요합니다.</div></noscript>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>PDF → 이미지 변환기 <span class="small">(클라이언트만으로 동작)</span></h1>
      <div class="body">
        <div class="row">
          <div class="col">
            <div id="drop" class="drop">
              <div><strong>PDF</strong> 파일을 끌어다 놓거나 선택하세요.</div>
              <div class="hint">각 페이지를 PNG/JPG 이미지로 저장합니다.</div>
              <div style="margin-top:10px"><label class="btn"><input id="file" type="file" accept="application/pdf" hidden>파일 선택</label></div>
            </div>
            <div class="opts" style="margin-top:12px">
              <label>출력 형식</label>
              <select id="fmt"><option value="png">PNG (무손실)</option><option value="jpeg">JPG (용량 작음)</option></select>
              <label>내보내기 해상도 스케일 (1 = 72dpi 기준)</label>
              <input id="scale" type="range" min="1" max="4" step="0.25" value="2" />
              <label>JPG 품질</label>
              <input id="jpgQ" type="range" min="0.5" max="1" step="0.05" value="0.92" />
            </div>
            <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
              <button id="btn" class="btn primary" disabled>모든 페이지 이미지로 저장</button>
              <div class="progress" style="flex:1"><div id="prog"></div></div>
            </div>
            <div class="small" id="count"></div>
          </div>

          <div class="col">
            <div class="viewer">
              <div class="vbar">
                <div class="seg"><strong>문서 보기</strong></div>
                <div class="seg">
                  <button id="prev" class="vbtn">이전</button>
                  <input id="pageInput" type="number" min="1" value="1" style="width:70px;background:#1f1f1f;border:1px solid #3a3a3a;color:#e6edf3;border-radius:8px;padding:6px 8px" />
                  <span class="small">/ <span id="total">0</span>페이지</span>
                  <button id="next" class="vbtn">다음</button>
                </div>
                <div class="seg" style="margin-left:auto">
                  <button id="zoomOut" class="vbtn">−</button>
                  <button id="zoomFit" class="vbtn">맞춤</button>
                  <button id="zoomIn" class="vbtn">＋</button>
                  <span id="zoomVal" class="small" style="margin-left:6px">100%</span>
                </div>
              </div>
              <div class="stage" id="stage"><canvas id="canvas"></canvas></div>
              <div class="hint">휠로 확대/축소, 드래그로 이동. 페이지 숫자 입력 또는 이전/다음 버튼으로 이동.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="usage">
      <h2>사용 방법</h2>
      <ul>
        <li><strong>파일 선택</strong>: PDF 파일을 드래그하거나 "파일 선택"을 눌러 업로드합니다.</li>
        <li><strong>문서 보기</strong>: 우측 뷰어에서 페이지를 확인하고 이전/다음 또는 숫자 입력으로 이동합니다.</li>
        <li><strong>확대/축소</strong>: 휠 스크롤, 또는 − / 맞춤 / ＋ 버튼으로 크기를 조절합니다.</li>
        <li><strong>이동</strong>: 확대 상태에서 캔버스를 드래그하면 화면을 이동합니다.</li>
        <li><strong>이미지로 저장</strong>: 출력 형식·해상도·JPG 품질을 선택 후 "모든 페이지 이미지로 저장"을 누르면 ZIP으로 저장합니다.</li>
      </ul>
    </div>

    <footer>
      주의: 브라우저 메모리 제약으로 매우 긴 PDF는 실패할 수 있습니다. 그럴 땐 해상도를 낮추거나 파일을 나눠 주세요.
    </footer>
  </div>

  <script>
  // ===== pdf.js loader (UMD, workerless) & App Logic =====
  (async function(){
    const $ = (s)=>document.querySelector(s);
    function loadScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.async=false; s.crossOrigin='anonymous'; s.onload=()=>res(true); s.onerror=()=>rej(new Error('load fail '+src)); document.head.appendChild(s); }); }
    async function ensurePDFJS(){ if(window.pdfjsLib) return true; const cdns=['https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/legacy/build/pdf.min.js','https://unpkg.com/pdfjs-dist@4.6.82/legacy/build/pdf.min.js','https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.min.js','https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/legacy/build/pdf.min.js','https://unpkg.com/pdfjs-dist@3.11.174/legacy/build/pdf.min.js','https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js']; for(const u of cdns){ try{ await loadScript(u); if(window.pdfjsLib) return true; }catch(e){} } return !!window.pdfjsLib; }
    if(!await ensurePDFJS()){ alert('pdf.js 로드 실패: 네트워크/차단기 확인 바랍니다.'); return; }

    const drop=$('#drop'), file=$('#file'), btn=$('#btn'), count=$('#count'), prog=$('#prog');
    const fmtSel=$('#fmt'), scaleSel=$('#scale'), jpgQSel=$('#jpgQ');
    const stage=$('#stage'), canvas=$('#canvas'), pageInput=$('#pageInput'), totalSpan=$('#total');
    const zoomInBtn=$('#zoomIn'), zoomOutBtn=$('#zoomOut'), zoomFitBtn=$('#zoomFit'), zoomVal=$('#zoomVal');
    const prevBtn=$('#prev'), nextBtn=$('#next');

    let pdfFile=null, pdfDoc=null, pageCache={}, curPage=1, viewScale=1, fitScale=1;

    const setDrag=(on)=>drop.classList.toggle('drag', !!on);
    ;['dragenter','dragover'].forEach(e=>drop.addEventListener(e, ev=>{ev.preventDefault(); setDrag(true);}));
    ;['dragleave','drop'].forEach(e=>drop.addEventListener(e, ev=>{ev.preventDefault(); setDrag(false);}));
    drop.addEventListener('drop', async ev=>{ ev.preventDefault(); await handlePDF([...ev.dataTransfer.files][0]); });
    file.addEventListener('change', async ev=>{ await handlePDF(ev.target.files[0]); });

    async function handlePDF(f){
      if(!f || f.type!=='application/pdf'){ alert('PDF를 선택하세요.'); return; }
      pdfFile=f; btn.disabled=true; prog.style.width='0%'; pageCache={}; curPage=1; viewScale=1; fitScale=1;
      const data=await f.arrayBuffer(); pdfDoc = await pdfjsLib.getDocument({ data, disableWorker: true }).promise;
      totalSpan.textContent = pdfDoc.numPages; pageInput.max = String(pdfDoc.numPages); pageInput.value = '1';
      count.textContent = `${pdfDoc.numPages}페이지`;
      await renderViewer('fit');
      btn.disabled=false;
    }

    async function getPage(p){ if(pageCache[p]) return pageCache[p]; const pg=await pdfDoc.getPage(p); pageCache[p]=pg; return pg; }

    async function renderViewer(mode){
      const page=await getPage(curPage);
      if(mode==='fit' || fitScale===1){
        const trial=page.getViewport({scale:1}); const w=stage.clientWidth-20, h=stage.clientHeight-20;
        const sx=w/trial.width, sy=h/trial.height; fitScale=Math.max(Math.min(sx, sy), 0.25); viewScale=fitScale;
      }
      const vp=page.getViewport({scale:viewScale}); canvas.width=vp.width; canvas.height=vp.height; const ctx=canvas.getContext('2d'); ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width,canvas.height);
      await page.render({canvasContext:ctx, viewport:vp}).promise; zoomVal.textContent = Math.round(viewScale*100) + '%';
    }

    function setZoom(mult){ viewScale=Math.min(Math.max(viewScale*mult, 0.25), 6); renderViewer(); }
    zoomInBtn.addEventListener('click', ()=>setZoom(1.2));
    zoomOutBtn.addEventListener('click', ()=>setZoom(1/1.2));
    zoomFitBtn.addEventListener('click', ()=>renderViewer('fit'));
    canvas.addEventListener('wheel', (e)=>{ e.preventDefault(); const d=e.deltaY>0? (1/1.15) : 1.15; setZoom(d); }, {passive:false});

    let isPanning=false, startX=0, startY=0, scrollLeft=0, scrollTop=0;
    stage.addEventListener('mousedown', (e)=>{ isPanning=true; startX=e.clientX; startY=e.clientY; scrollLeft=stage.scrollLeft; scrollTop=stage.scrollTop; stage.style.cursor='grabbing'; });
    window.addEventListener('mouseup', ()=>{ isPanning=false; stage.style.cursor='default'; });
    stage.addEventListener('mousemove', (e)=>{ if(!isPanning) return; const dx=e.clientX-startX, dy=e.clientY-startY; stage.scrollLeft = scrollLeft - dx; stage.scrollTop = scrollTop - dy; });

    prevBtn.addEventListener('click', ()=>{ if(!pdfDoc) return; curPage = Math.max(1, curPage-1); pageInput.value=curPage; renderViewer('fit'); });
    nextBtn.addEventListener('click', ()=>{ if(!pdfDoc) return; curPage = Math.min(pdfDoc.numPages, curPage+1); pageInput.value=curPage; renderViewer('fit'); });
    pageInput.addEventListener('change', ()=>{ if(!pdfDoc) return; let v=parseInt(pageInput.value)||1; v=Math.min(Math.max(1,v), pdfDoc.numPages); curPage=v; renderViewer('fit'); });

    btn.addEventListener('click', async ()=>{
      if(!pdfDoc){ alert('PDF를 먼저 선택하세요.'); return; }
      btn.disabled=true; prog.style.width='0%';
      try{
        const base = pdfFile.name.replace(/\.pdf$/i,''); const fmt=fmtSel.value; const escale=parseFloat(scaleSel.value)||2; const jpgQ=parseFloat(jpgQSel.value)||0.92;
        if(!window.JSZip){ await loadScript('https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js'); }
        const zip = new JSZip();
        for(let p=1;p<=pdfDoc.numPages;p++){
          const page = await getPage(p); const vp = page.getViewport({ scale: escale });
          const c = document.createElement('canvas'); c.width=Math.floor(vp.width); c.height=Math.floor(vp.height);
          const ctx = c.getContext('2d',{willReadFrequently:true}); await page.render({canvasContext:ctx, viewport:vp}).promise;
          const blob = await new Promise(res=> c.toBlob(res, `image/${fmt}`, fmt==='jpeg'? jpgQ : undefined));
          const buf = await blob.arrayBuffer(); zip.file(`${base}_p${String(p).padStart(3,'0')}.${fmt==='jpeg'?'jpg':'png'}`, buf);
          prog.style.width = `${Math.round((p/pdfDoc.numPages)*100)}%`; await new Promise(r=>setTimeout(r));
        }
        const out = await zip.generateAsync({type:'blob'}); const url=URL.createObjectURL(out); const a=document.createElement('a'); a.href=url; a.download=`${base}_pages.zip`; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000);
      }catch(e){ console.error(e); alert('추출 중 오류가 발생했습니다. (콘솔 확인)'); }
      finally{ btn.disabled=false; prog.style.width='0%'; }
    });
  })();
  </script>
</body>
</html>
